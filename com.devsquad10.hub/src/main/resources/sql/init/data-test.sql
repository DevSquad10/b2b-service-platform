-- 허브 기본 17개 데이터 삽입 (임의의 UUID 사용)
INSERT INTO p_hub (id, name, address, latitude, longitude, created_at, created_by, updated_at, updated_by)
VALUES
    ('11111111-1111-1111-1111-111111111101', '서울특별시 센터', '서울특별시 송파구 송파대로 55', 37.4747005, 127.123397, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111102', '경기 북부 센터', '경기도 고양시 덕양구 권율대로 570', 37.6404095, 126.8737802, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111103', '경기 남부 센터', '경기도 이천시 호법면 덕평로 257-21', 37.1903115, 127.3760896, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111104', '부산광역시 센터', '부산 동구 중앙대로 206', 35.11571, 129.0428216, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111105', '대구광역시 센터', '대구 북구 태평로 161', 35.8758026, 128.5959092, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111106', '인천광역시 센터', '인천 남동구 정각로 29', 37.4558148, 126.7062842, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111107', '광주광역시 센터', '광주 서구 내방로 111', 35.1597705, 126.8515218, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111108', '대전광역시 센터', '대전 서구 둔산로 100', 36.3501707, 127.3848389, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111101', '울산광역시 센터', '울산 남구 중앙로 201', 35.5388808, 129.3115449, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111110', '세종특별자치시 센터', '세종특별자치시 한누리대로 2130', 36.4799427, 127.289059, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111111', '강원특별자치도 센터', '강원특별자치도 춘천시 중앙로2가 1', 37.882531, 127.7291452, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111112', '충청북도 센터', '충북 청주시 상당구 상당로 82', 36.6353828, 127.4914807, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111113', '충청남도 센터', '충남 홍성군 홍북읍 충남대로 21', 36.6588409, 126.6736967, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111114', '전북특별자치도 센터', '전북특별자치도 전주시 완산구 효자로 225', 35.8200701, 127.1091229, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111115', '전라남도 센터', '전남 무안군 삼향읍 오룡길 1', 34.8152658, 126.4573699, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111116', '경상북도 센터', '경북 안동시 풍천면 도청대로 455', 36.5753879, 128.5054506, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001'),
    ('11111111-1111-1111-1111-111111111117', '경상남도 센터', '경남 창원시 의창구 중앙대로 300', 35.237101, 128.6912625, now(), '00000000-0000-0000-0000-000000000001', now(), '00000000-0000-0000-0000-000000000001')
ON CONFLICT (id) DO NOTHING;

-- 허브 간 연결 정보 초기화 (모든 가능한 연결 조합 FALSE로 설정)
-- 17개 허브 간 272개 가능한 모든 연결 (단방향)
WITH hubs AS (
    SELECT id FROM p_hub
)
INSERT INTO p_hub_connection (id, hub_id, connected_hub_id, weight, active, created_at, created_by, updated_at, updated_by)
SELECT
    gen_random_uuid(),
    h1.id,
    h2.id,
    999999999, -- 매우 큰 가중치 (연결되지 않음)
    FALSE,
    NOW(),
    '00000000-0000-0000-0000-000000000001',
    NOW(),
    '00000000-0000-0000-0000-000000000001'
FROM hubs h1
     CROSS JOIN hubs h2
WHERE h1.id != h2.id
ON CONFLICT (id) DO NOTHING;

-- 허브 간 연결 정보 업데이트
-- 가중치 : (NAVER DIRECTIONS 5 API 기준 소요시간 기반 임의값)
-- 상행, 하행 소요시간이 같다고 가정
WITH hub_route_updates AS (
    SELECT *
    FROM (VALUES
              -- 경기남부 연결 (경기북부, 서울, 인천, 강원도, 경상북도, 대전, 대구)
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111102', 5743704, TRUE), -- 경기남부-경기북부
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111101', 2979490, TRUE), -- 경기남부-서울
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111106', 4583228, TRUE), -- 경기남부-인천
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111111', 6936973, TRUE), -- 경기남부-강원도
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111116', 9361158, TRUE), -- 경기남부-경상북도
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111108', 5683576, TRUE), -- 경기남부-대전
              ('11111111-1111-1111-1111-111111111103', '11111111-1111-1111-1111-111111111105', 11220686, TRUE), -- 경기남부-대구

              -- 대전 연결 (충청남도, 충청북도, 세종, 전라북도, 광주, 전라남도, 경기남부, 대구)
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111113', 4262370, TRUE), -- 대전-충청남도
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111112', 3487969, TRUE), -- 대전-충청북도
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111110', 2137976, TRUE), -- 대전-세종
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111114', 4615053, TRUE), -- 대전-전라북도
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111107', 6952488, TRUE), -- 대전-광주
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111115', 9201505, TRUE), -- 대전-전라남도
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111103', 5472035, TRUE), -- 대전-경기남부
              ('11111111-1111-1111-1111-111111111108', '11111111-1111-1111-1111-111111111105', 6486025, TRUE), -- 대전-대구

              -- 대구 연결 (경상북도, 경상남도, 부산, 울산, 경기남부, 대전)
              ('11111111-1111-1111-1111-111111111105', '11111111-1111-1111-1111-111111111116', 4509465, TRUE), -- 대구-경상북도
              ('11111111-1111-1111-1111-111111111105', '11111111-1111-1111-1111-111111111117', 5067543, TRUE), -- 대구-경상남도
              ('11111111-1111-1111-1111-111111111105', '11111111-1111-1111-1111-111111111104', 5114551, TRUE), -- 대구-부산
              ('11111111-1111-1111-1111-111111111105', '11111111-1111-1111-1111-111111111109', 5298375, TRUE), -- 대구-울산
              ('11111111-1111-1111-1111-111111111105', '11111111-1111-1111-1111-111111111103', 9428185, TRUE), -- 대구-경기남부
              ('11111111-1111-1111-1111-111111111105', '11111111-1111-1111-1111-111111111108', 6399241, TRUE), -- 대구-대전

              -- 경상북도 연결 (경기남부, 대구)
              ('11111111-1111-1111-1111-111111111116', '11111111-1111-1111-1111-111111111103', 8375210, TRUE), -- 경상북도-경기남부
              ('11111111-1111-1111-1111-111111111116', '11111111-1111-1111-1111-111111111105', 4633351, TRUE)  -- 경상북도-대구
         ) AS t(hub_id, connected_hub_id, weight, active)
)

-- 일괄 업데이트
UPDATE p_hub_connection c
SET
    weight = u.weight,
    active = u.active
FROM hub_route_updates u
WHERE c.hub_id = u.hub_id::uuid
AND c.connected_hub_id = u.connected_hub_id::uuid;

-- 역방향 업데이트
WITH reverse_routes AS (
    SELECT
        connected_hub_id AS hub_id,
        hub_id AS connected_hub_id,
        weight,
        active
    FROM p_hub_connection
    WHERE active = TRUE
)
UPDATE p_hub_connection c
SET
    weight = r.weight,
    active = r.active
FROM reverse_routes r
WHERE c.hub_id = r.hub_id::uuid
AND c.connected_hub_id = r.connected_hub_id::uuid;

